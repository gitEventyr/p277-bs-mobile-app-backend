<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">
    <i class="bi bi-speedometer2"></i>
    Dashboard
  </h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <!-- Export functionality not implemented yet -->
  </div>
</div>

<!-- Block 1: User Metrics -->
<div class="row">
  <div class="col-xl-4 col-md-6 mb-4">
    <div class="card border-left-primary shadow h-100 py-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Total number of registered active users in the system">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
              Total Users
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.totalUsers}}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-people fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-4 col-md-6 mb-4">
    <div class="card border-left-success shadow h-100 py-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Active users are those who have logged in, played games, or made transactions in the last 30 days">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
              Active Users (30d)
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.activeUsers}}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-person-check fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-4 col-md-6 mb-4">
    <div class="card border-left-warning shadow h-100 py-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Number of active users who registered in the last 24 hours">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
              New Registrations (24h)
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.newRegistrations}}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-person-plus fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Block 2: Coin Balance Metrics -->
<div class="row">
  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card border-left-info shadow h-100 py-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Total coin balance across all active users">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
              Total Coin Balance
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.totalBalance}}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-coin fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card border-left-info shadow h-100 py-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Average coin balance per active user">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
              Average Coin Balance
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.averageBalance}}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-calculator fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card border-left-purple shadow h-100 py-2" style="border-left-color: #6f42c1 !important;" data-bs-toggle="tooltip" data-bs-placement="top" title="Total Reward Points balance across all active users">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-uppercase mb-1" style="color: #6f42c1;">
              Total RP Balance
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.totalRpBalance}}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-gem fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card border-left-secondary shadow h-100 py-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Average Reward Points balance per active user">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-secondary text-uppercase mb-1">
              Average RP Balance
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.averageRpBalance}}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-calculator fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Block 3: Revenue and Casino Actions -->
<div class="row">
  <!-- In-app Revenue -->
  <div class="col-md-6 col-xl mb-4">
    <div class="card border-left-success shadow h-100 py-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Total revenue generated from all in-app purchases">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
              In-app Revenue
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">${{stats.totalRevenue}}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-currency-dollar fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- All Deposits -->
  <div class="col-md-6 col-xl mb-4">
    <div class="card border-left-info shadow h-100 py-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Total number of all casino deposit actions">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
              All Deposits
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.allDeposits}}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-wallet2 fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- All Registrations -->
  <div class="col-md-6 col-xl mb-4">
    <div class="card border-left-primary shadow h-100 py-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Total number of all casino registration actions">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
              All Registrations
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.allRegistrations}}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-person-plus fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Unique Deposits -->
  <div class="col-md-6 col-xl mb-4">
    <div class="card border-left-warning shadow h-100 py-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Number of unique deposit actions (unique by visitor per casino)">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
              Unique Deposits
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.uniqueDeposits}}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-cash-coin fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Unique Registrations -->
  <div class="col-md-6 col-xl mb-4">
    <div class="card border-left-secondary shadow h-100 py-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Number of unique registration actions (unique by visitor per casino)">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-secondary text-uppercase mb-1">
              Unique Registrations
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{stats.uniqueRegistrations}}</div>
          </div>
          <div class="col-auto">
            <i class="bi bi-person-check fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Block 4: Slot Player Behavior -->
<div class="row">
  <div class="col-lg-12">
    <div class="card shadow mb-4" data-bs-toggle="tooltip" data-bs-placement="top" title="Analytics of active player behavior in slot games">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
          <i class="bi bi-graph-up"></i>
          Slot Player Behavior
        </h6>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-3 col-sm-6 mb-3">
            <div class="text-center p-3 border rounded">
              <div class="h3 mb-2 font-weight-bold text-primary">{{gameAnalytics.playerBehavior.totalActivePlayers}}</div>
              <div class="text-xs font-weight-bold text-primary text-uppercase">Active Players</div>
            </div>
          </div>

          <div class="col-md-3 col-sm-6 mb-3">
            <div class="text-center p-3 border rounded">
              <div class="h3 mb-2 font-weight-bold text-success">{{gameAnalytics.playerBehavior.avgPlaysPerPlayer}}</div>
              <div class="text-xs font-weight-bold text-success text-uppercase">Avg Plays/Player</div>
            </div>
          </div>

          <div class="col-md-3 col-sm-6 mb-3">
            <div class="text-center p-3 border rounded">
              <div class="h3 mb-2 font-weight-bold text-info">{{gameAnalytics.playerBehavior.avgBetPerPlayer}}</div>
              <div class="text-xs font-weight-bold text-info text-uppercase">Avg Bet/Player</div>
            </div>
          </div>

          <div class="col-md-3 col-sm-6 mb-3">
            <div class="text-center p-3 border rounded">
              <div class="h3 mb-2 font-weight-bold text-warning">{{gameAnalytics.playerBehavior.totalGameRevenue}}</div>
              <div class="text-xs font-weight-bold text-warning text-uppercase">Games Coins Spent</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Block 5: User Level Distribution & Top Spenders -->
<div class="row">
  <div class="col-lg-6">
    <div class="card shadow mb-4" data-bs-toggle="tooltip" data-bs-placement="top" title="Distribution of active users across different experience levels">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
          <i class="bi bi-bar-chart"></i>
          User Level Distribution
        </h6>
      </div>
      <div class="card-body">
        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
          <table class="table table-sm table-hover">
            <thead class="sticky-top bg-white">
              <tr>
                <th>Level</th>
                <th>Users</th>
                <th>Percentage</th>
              </tr>
            </thead>
            <tbody>
              {{#each userAnalytics.userLevelDistribution}}
              <tr>
                <td><span class="badge bg-info">Level {{this.level}}</span></td>
                <td>{{this.userCount}}</td>
                <td>
                  <div class="progress" style="height: 20px;">
                    <div class="progress-bar" role="progressbar" style="width: {{this.percentage}}%" aria-valuenow="{{this.percentage}}" aria-valuemin="0" aria-valuemax="100">
                      {{this.percentage}}%
                    </div>
                  </div>
                </td>
              </tr>
              {{/each}}
              {{#unless userAnalytics.userLevelDistribution.length}}
              <tr>
                <td colspan="3" class="text-muted text-center">No user level data available</td>
              </tr>
              {{/unless}}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <!-- Top Spenders Card -->
    <div class="card shadow mb-4" id="topSpendersCard" data-bs-toggle="tooltip" data-bs-placement="top" title="Top 10 active users by total purchase amount">
      <div class="card-header py-3 d-flex justify-content-between align-items-center">
        <h6 class="m-0 font-weight-bold text-primary">
          <i class="bi bi-trophy"></i>
          Top Spenders
        </h6>
        <button class="btn btn-sm btn-outline-primary" onclick="toggleTransactionView()">
          <i class="bi bi-clock-history"></i>
          View Last Transactions
        </button>
      </div>
      <div class="card-body">
        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
          <table class="table table-sm table-hover">
            <thead class="sticky-top bg-white">
              <tr>
                <th>User</th>
                <th>Total Spent</th>
                <th>Transactions</th>
              </tr>
            </thead>
            <tbody>
              {{#each revenueAnalytics.topSpenders}}
              <tr>
                <td>
                  <div class="d-flex align-items-center">
                    <div class="avatar-sm me-2">
                      <i class="bi bi-person-circle"></i>
                    </div>
                    <div>
                      <div>{{this.name}}</div>
                      <small class="text-muted">{{this.email}}</small>
                    </div>
                  </div>
                </td>
                <td><strong>${{this.totalSpent}}</strong></td>
                <td><span class="badge bg-primary">{{this.transactionCount}}</span></td>
              </tr>
              {{/each}}
              {{#unless revenueAnalytics.topSpenders.length}}
              <tr>
                <td colspan="3" class="text-muted text-center">No purchase data available</td>
              </tr>
              {{/unless}}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Last 10 Transactions Card (Hidden by default) -->
    <div class="card shadow mb-4" id="lastTransactionsCard" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="Latest 10 purchases">
      <div class="card-header py-3 d-flex justify-content-between align-items-center">
        <h6 class="m-0 font-weight-bold text-primary">
          <i class="bi bi-clock-history"></i>
          Last 10 Transactions
        </h6>
        <button class="btn btn-sm btn-outline-primary" onclick="toggleTransactionView()">
          <i class="bi bi-trophy"></i>
          View Top Spenders
        </button>
      </div>
      <div class="card-body">
        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
          <table class="table table-sm table-hover">
            <thead class="sticky-top bg-white">
              <tr>
                <th>User</th>
                <th>Amount</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              {{#each revenueAnalytics.lastTransactions}}
              <tr>
                <td>
                  <div class="d-flex align-items-center">
                    <div class="avatar-sm me-2">
                      <i class="bi bi-person-circle"></i>
                    </div>
                    <div>
                      <div>{{this.userName}}</div>
                      <small class="text-muted">{{this.userEmail}}</small>
                    </div>
                  </div>
                </td>
                <td>
                  <strong>${{this.amount}}</strong>
                </td>
                <td>
                  <small>{{formatDate this.purchasedAt}}</small>
                </td>
              </tr>
              {{/each}}
              {{#unless revenueAnalytics.lastTransactions.length}}
              <tr>
                <td colspan="3" class="text-muted text-center">No transactions available</td>
              </tr>
              {{/unless}}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Initialize Bootstrap Tooltips -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize all Bootstrap tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });
  });

  // Toggle between Top Spenders and Last Transactions cards
  function toggleTransactionView() {
    const topSpendersCard = document.getElementById('topSpendersCard');
    const lastTransactionsCard = document.getElementById('lastTransactionsCard');

    if (topSpendersCard.style.display === 'none') {
      topSpendersCard.style.display = 'block';
      lastTransactionsCard.style.display = 'none';
    } else {
      topSpendersCard.style.display = 'none';
      lastTransactionsCard.style.display = 'block';
    }
  }
</script>